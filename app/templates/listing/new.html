{% extends "/components/base.html" %} {% block title %}Add New Item - ReWear{%
endblock %} {% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/new.css') }}" />
{% endblock %} {% block content %}
<div class="add-item-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-plus-circle me-2"></i>
        Add New Item
      </h1>
      <p class="page-subtitle">
        Share your fashion treasures with the ReWear community
      </p>
    </div>
  </div>

  <!-- Main Form Card -->
  <div class="form-card">
    <form
      action="{{ url_for('listing.createListing') }}"
      method="POST"
      id="addItemForm">
      <!-- Image URL Section -->
      <div class="section-card image-section">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-camera me-2"></i>
            Item Image
          </h3>
          <p class="section-subtitle">
            Provide an image URL to showcase your item
          </p>
        </div>

        <div class="image-url-area">
          <div class="form-group">
            <label for="image_url" class="form-label">
              <i class="fas fa-link me-2"></i>
              Image URL
            </label>
            <input
              type="url"
              id="image_url"
              name="image_url"
              class="form-control"
              placeholder="https://example.com/your-image.jpg"
              onchange="previewImage(this.value)" />
            <div class="form-hint">
              Paste a direct link to your image (JPG, PNG, etc.)
            </div>
          </div>

          <div class="image-preview-area" id="imagePreviewArea">
            <div class="preview-placeholder" id="previewPlaceholder">
              <i class="fas fa-image"></i>
              <p>Image preview will appear here</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Item Details Section -->
      <div class="section-card details-section">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-info-circle me-2"></i>
            Item Details
          </h3>
          <p class="section-subtitle">
            Provide detailed information about your item
          </p>
        </div>

        <div class="form-grid">
          <!-- Title -->
          <div class="form-group full-width">
            <label for="title" class="form-label">
              <i class="fas fa-tag me-2"></i>
              Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              class="form-control"
              placeholder="Enter a catchy title for your item"
              required />
            <div class="form-hint">Make it descriptive and appealing</div>
          </div>

          <!-- Description -->
          <div class="form-group full-width">
            <label for="description" class="form-label">
              <i class="fas fa-align-left me-2"></i>
              Description
            </label>
            <textarea
              id="description"
              name="description"
              class="form-control"
              rows="4"
              placeholder="Describe your item's condition, style, and any special features..."></textarea>
            <div class="form-hint">
              Include size, condition, brand, and styling tips
            </div>
          </div>

          <!-- Category -->
          <div class="form-group">
            <label for="category" class="form-label">
              <i class="fas fa-users me-2"></i>
              Category *
            </label>
            <select id="category" name="category" class="form-control" required>
              <option value="">Select Category</option>
              <option value="Men">Men</option>
              <option value="Women">Women</option>
              <option value="Kids">Kids</option>
            </select>
          </div>

          <!-- Type -->
          <div class="form-group">
            <label for="type" class="form-label">
              <i class="fas fa-tshirt me-2"></i>
              Type *
            </label>
            <select id="type" name="type" class="form-control" required>
              <option value="">Select Type</option>
              <option value="Shirt">Shirt</option>
              <option value="Pants">Pants</option>
              <option value="Dress">Dress</option>
              <option value="Others">Others</option>
            </select>
          </div>

          <!-- Size -->
          <div class="form-group">
            <label for="size" class="form-label">
              <i class="fas fa-ruler me-2"></i>
              Size *
            </label>
            <select id="size" name="size" class="form-control" required>
              <option value="">Select Size</option>
              <option value="S">Small (S)</option>
              <option value="M">Medium (M)</option>
              <option value="L">Large (L)</option>
              <option value="XL">Extra Large (XL)</option>
            </select>
          </div>

          <!-- Point Value -->
          <div class="form-group">
            <label for="point_value" class="form-label">
              <i class="fas fa-coins me-2"></i>
              Point Value
            </label>
            <input
              type="number"
              id="point_value"
              name="point_value"
              class="form-control"
              value="100"
              min="0"
              step="10"
              placeholder="100" />
            <div class="form-hint">Points others will earn by swapping</div>
          </div>

          <!-- Condition -->
          <div class="form-group">
            <label for="condition" class="form-label">
              <i class="fas fa-star me-2"></i>
              Condition
            </label>
            <select id="condition" name="condition" class="form-control">
              <option value="">Select Condition</option>
              <option value="New">New</option>
              <option value="Like New">Like New</option>
              <option value="Good">Good</option>
              <option value="Acceptable">Acceptable</option>
            </select>
          </div>

          <!-- Tags -->
          <div class="form-group full-width">
            <label for="tags" class="form-label">
              <i class="fas fa-hashtag me-2"></i>
              Tags
            </label>
            <input
              type="text"
              id="tags"
              name="tags"
              class="form-control"
              placeholder="casual, vintage, summer, designer..." />
            <div class="form-hint">Add relevant tags separated by commas</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-section">
        <div class="action-buttons">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="history.back()">
            <i class="fas fa-times me-2"></i>
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane me-2"></i>
            Submit for Review
          </button>
        </div>
        <div class="submit-info">
          <i class="fas fa-info-circle me-2"></i>
          Your item will be reviewed by our team before going live
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="imagePreviewModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Image Preview</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img id="previewImage" src="" alt="Preview" class="img-fluid" />
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Form validation
    document
      .getElementById("addItemForm")
      .addEventListener("submit", function (e) {
        const title = document.getElementById("title").value.trim();
        const category = document.getElementById("category").value;
        const type = document.getElementById("type").value;
        const size = document.getElementById("size").value;

        if (!title || !category || !type || !size) {
          e.preventDefault();
          alert("Please fill in all required fields.");
          return false;
        }
      });
  });

  // Global function to preview image from URL
  function previewImage(url) {
    const previewArea = document.getElementById("imagePreviewArea");
    const placeholder = document.getElementById("previewPlaceholder");

    if (!url || url.trim() === "") {
      // Show placeholder when no URL
      previewArea.innerHTML = `
        <div class="preview-placeholder" id="previewPlaceholder">
          <i class="fas fa-image"></i>
          <p>Image preview will appear here</p>
        </div>
      `;
      return;
    }

    // Create image element to test if URL is valid
    const testImg = new Image();

    testImg.onload = function () {
      // Image loaded successfully, show preview
      previewArea.innerHTML = `
        <div class="image-preview-success">
          <img src="${url}" alt="Image preview" class="preview-image" 
               onclick="showFullPreview('${url}')">
          <div class="preview-overlay">
            <button type="button" class="btn btn-sm btn-light" 
                    onclick="showFullPreview('${url}')">
              <i class="fas fa-eye"></i> View Full Size
            </button>
          </div>
        </div>
      `;
    };

    testImg.onerror = function () {
      // Image failed to load, show error
      previewArea.innerHTML = `
        <div class="preview-error">
          <i class="fas fa-exclamation-triangle"></i>
          <p>Unable to load image from this URL</p>
          <small>Please check the URL and try again</small>
        </div>
      `;
    };

    // Start loading the image
    testImg.src = url;

    // Show loading state
    previewArea.innerHTML = `
      <div class="preview-loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading image preview...</p>
      </div>
    `;
  }

  // Global function to show full preview
  function showFullPreview(url) {
    document.getElementById("previewImage").src = url;
    new bootstrap.Modal(document.getElementById("imagePreviewModal")).show();
  }
</script>
{% endblock %}
